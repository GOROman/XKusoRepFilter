# Chrome ウェブストア公開用CI/CDガイド

このドキュメントでは、GitHub Actionsを使用してXKusoRepFilter拡張機能をChrome ウェブストアに自動的に公開する方法について説明します。

## 概要

このCI/CDワークフローは以下の機能を提供します：

1. 拡張機能のビルドと最適化
2. Chrome ウェブストア用のパッケージ作成
3. Chrome ウェブストアへの自動公開
4. リリースノートの管理

## 前提条件

1. Chrome ウェブストア開発者アカウント
2. Chrome ウェブストアAPIアクセス用の認証情報
3. GitHubリポジトリへの適切な権限

## 必要なシークレット

以下のシークレットをGitHubリポジトリに設定する必要があります：

1. `EXTENSION_ID` - Chrome ウェブストアの拡張機能ID
2. `CLIENT_ID` - Google OAuth クライアントID
3. `CLIENT_SECRET` - Google OAuth クライアントシークレット
4. `REFRESH_TOKEN` - Google OAuth リフレッシュトークン

### シークレットの設定方法

1. GitHubリポジトリの「Settings」タブを開く
2. 左側のメニューから「Secrets and variables」→「Actions」を選択
3. 「New repository secret」ボタンをクリックして各シークレットを追加

## 認証情報の取得方法

### 拡張機能IDの取得

1. 拡張機能をChrome ウェブストアに初回登録する
2. 登録後、ダッシュボードに表示される拡張機能IDをコピー

### Google OAuth認証情報の取得

1. [Google Cloud Console](https://console.cloud.google.com/)にアクセス
2. 新しいプロジェクトを作成
3. 「APIとサービス」→「認証情報」を選択
4. 「認証情報を作成」→「OAuthクライアントID」を選択
5. アプリケーションタイプとして「デスクトップアプリ」を選択
6. クライアントIDとクライアントシークレットを取得

### リフレッシュトークンの取得

以下のコマンドを使用してリフレッシュトークンを取得します：

```bash
# 必要なパッケージのインストール
npm install -g chrome-webstore-upload-cli

# リフレッシュトークンの取得
chrome-webstore-upload-cli refresh-token --client-id=YOUR_CLIENT_ID --client-secret=YOUR_CLIENT_SECRET
```

表示される指示に従ってGoogleアカウントで認証し、リフレッシュトークンを取得します。

## ワークフローの使用方法

### 手動トリガー

1. GitHubリポジトリの「Actions」タブを開く
2. 「Chrome ウェブストア公開」ワークフローを選択
3. 「Run workflow」ボタンをクリック
4. 以下の情報を入力：
   - バージョン：拡張機能の新しいバージョン（例：1.4.3）
   - リリースノート：変更内容の説明
5. 「Run workflow」ボタンをクリックして実行

### 自動トリガー

このワークフローは、GitHubでリリースが公開されたときにも自動的に実行されます：

1. GitHubリポジトリの「Releases」タブを開く
2. 「Draft a new release」ボタンをクリック
3. タグバージョンとリリースタイトルを入力
4. リリースノートを記入
5. 「Publish release」ボタンをクリック

リリースが公開されると、ワークフローが自動的に実行され、Chrome ウェブストアに拡張機能が公開されます。

## ワークフローの詳細

### ビルドジョブ

1. リポジトリのチェックアウト
2. Node.jsのセットアップ
3. 依存関係のインストール
4. マニフェストのバージョン更新（手動トリガーの場合）
5. webpackの設定ファイル作成
6. 拡張機能のビルド
7. Chrome ウェブストア用ZIPファイルの作成
8. 成果物のアップロード

### 公開ジョブ

1. ビルド成果物のダウンロード
2. Chrome ウェブストアへの公開
3. リリースノートの作成
4. 公開完了通知

## トラブルシューティング

### 公開に失敗する場合

1. GitHubのActionsタブでワークフローの実行ログを確認
2. シークレットが正しく設定されているか確認
3. Chrome ウェブストアのダッシュボードで拡張機能のステータスを確認

### 認証エラーが発生する場合

1. リフレッシュトークンの有効期限が切れていないか確認
2. 必要に応じて新しいリフレッシュトークンを生成
3. GitHubのシークレットを更新

## 注意事項

- Chrome ウェブストアの審査には時間がかかる場合があります
- 公開後も審査が必要なため、すぐにユーザーに配信されるわけではありません
- マニフェストのバージョンは必ず前回より大きな値にしてください
- リリースノートは明確で詳細なものを記載してください
